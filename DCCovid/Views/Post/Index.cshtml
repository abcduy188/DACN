@model IEnumerable<DCCovid.Models.PostCMT>
@using System.Globalization;
@{
    ViewBag.Title = "Index";
    var sess = Session["MEMBER"] as DCCovid.Common.UserLogin;
    var img = (List<DCCovid.Models.Image>)ViewBag.ListImg;
}
@section scripts
{
    <script>
        var path_to_delete;

        $(".deletePost").click(function (e) {
            path_to_delete = $(this).data('path');
        });
        $('#btnContinueDeletePost').click(function () {
            window.location = path_to_delete;
        });
    </script>
}
<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            Người tạo
        </th>
        <th>
            Ngày tạo
        </th>
        <th>
            
        </th>
        <th>
            
        </th>
        <th>

        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
<tr>
    <td>
        @item.CreateBy
    </td>
    <td>
        @{

            //DateTime date1 = DateTime.Parse(DateTime.Now.ToString("dd/MM/yyyy"));
            //DateTime date2 = DateTime.ParseExact(item.CreateDay.Value.ToString("dd/MM/yyyy"));
            //DateTime pDate = DateTime.ParseExact(item.CreateDay.Value.ToString(), "MM/dd/yyyy", CultureInfo.InvariantCulture);
            //var dateOnly = pDate.ToString("dd/MM/yyyy");

            @*int result = DateTime.Compare(date1, date2);
            if (result > 0)
            {
                @item.CreateDay.Value.ToString("HH:mm dd/MM")
            }
            else
            {
                @item.CreateDay.Value.ToString("HH:mm")
            }*@
        }
        @item.CreateDay.Value.ToString("HH:mm dd/MM")
    </td>
    <td>
        @Html.DisplayFor(modelItem => item.Text)
    </td>
    <td>
        @if (img != null)
        {
            foreach (var image in img.Where(d=>d.TypeID == item.ID))
            { //từ list hình ảnh ở viewbag, dùng foreach lấy ra  những hình ảnh có typeID = id của product

                <img src="~/Assets/Thumbnails/@image.FileName" style="height:100px" />
            }
        }

    </td>

    <td>

        @{
            DCCovid.Models.DCCovidDbcontext db = new DCCovid.Models.DCCovidDbcontext();
            var count = 0;
            count = item.Users.Count();
            item.LikeCount = count;
            <span>@item.LikeCount Like |||</span>
            if (sess != null)
            {
                var user = db.Users.Find(sess.UserID);
                if (user != null)
                {
                    if (item.Users.Count(d => d.ID == sess.UserID) != 0)
                    {
                        @Html.ActionLink("Dislike", "DisLike", new { id = item.ID })
                    }
                    else
                    {
                        @Html.ActionLink("Like", "Like", new { id = item.ID })
                    }
                }


            }
            item.LikeCount = count;

        }

    </td>
    <td>
        @Html.ActionLink("Binh Luan", "Details", new { id = item.ID })
        @{

            if (sess != null)
            {
                if (item.CreateBy == sess.Name)
                {
                    <a id="deletePost" class="deletePost" data-target="#basic"
                       data-toggle="modal"
                       data-path="@Url.Action("Delete", "Post", new { @id = @item.ID })">Xóa</a>
                }
                else
                {
                    <span>

                    </span>
                }
            }
            else
            {
                <span>

                </span>
            }


        }

    </td>
</tr>
    }

</table>
<div class="modal fade" id="basic" tabindex="-1" role="basic" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Delete Confirmation</h4>
            </div>
            <div class="modal-body">
                Xóa Post nay?

            </div>
            <div class="modal-footer">
                <button data-dismiss="modal" type="button" class="btn btn-default">Cancel</button>
                <button id="btnContinueDeletePost" type="button" class="btn btn-primary">Delete</button>
            </div>
        </div>
    </div>
</div>